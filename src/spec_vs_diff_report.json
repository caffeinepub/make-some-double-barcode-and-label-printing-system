{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-06T22:20:03.610Z",
  "summary": "Diff introduces a unified layout model (labelLayoutModel) and a shared canvas preview renderer (labelPreviewRenderer), and updates LabelSettings to compute preview layout from saved LabelConfig values. Backend LabelConfig is extended to persist layout/position fields, with a migration module added. However, the diff evidence does not show UI controls for all required position adjustments (notably explicit barcode/text X/Y), nor does it clearly demonstrate that non-centered (manual) X positioning is respected consistently across preview and CPCL generation.",
  "missing_requirements": [
    {
      "id": "REQ-10",
      "requirement": "Ensure Label Settings position adjustments (barcodePositionX/Y, textPositionX/Y, barcodeHeight, barcodeWidthScale, horizontalSpacing, and any gap/spacing controls) are loaded from the saved backend LabelConfig, editable in the UI, persisted back to the backend on Save, and applied to CPCL printing (not preview-only).",
      "reason": "LabelSettings in the diff shows state and controls for barcodeHeight, barcodeWidthScale, a derived textGap, blockSpacing (horizontalSpacing), and centerContents, but does not show any UI/editable inputs for explicit barcodePositionX/Y or textPositionX/Y; therefore it is not evidenced that those required position adjustments are editable and persisted/applied.",
      "evidence": [
        "frontend/src/pages/LabelSettings.tsx"
      ]
    },
    {
      "id": "REQ-11",
      "requirement": "Update the unified layout computation to correctly respect user-configured text positioning when centering is disabled, and keep title/barcode/text X calculations consistent between preview and CPCL (avoid preview-only text width approximations that cause drift).",
      "reason": "The unified layout model includes centered X calculations based on simple text-length * fontSize approximations (e.g., calculateCenteredTextX/titleX). The diff does not provide evidence that when centering is disabled the model uses config-provided textPositionX (and other X overrides) consistently, nor that CPCL generation uses the same exact text-width logic as preview (only the preview renderer is shown).",
      "evidence": [
        "frontend/src/utils/labelLayoutModel.ts",
        "frontend/src/utils/labelPreviewRenderer.ts",
        "frontend-file-summaries.txt"
      ]
    }
  ],
  "hallucinated_features": [],
  "confidence": 0.63,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/pages/LabelSettings.tsx",
    "frontend/src/utils/labelLayoutModel.ts",
    "frontend/src/utils/labelPreviewRenderer.ts",
    "project_state.json"
  ]
}